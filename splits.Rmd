---
title: "Mario Kart Speedruns"
output:
  flexdashboard::flex_dashboard:
    orientation: columns
    navbar:
      - { icon: "fas fa-home", href: "index.html", align: right}
---

```{bash llstocsv, include=FALSE}
# Convert all lss files in folder to csv
MK8D_trk2csv ./_data/splits ./_data/splits MK8D_trks.csv
```

```{r libs}
library(tidyverse)
library(lubridate)
library(plotly)
```

```{r import}
# Correct inconsistencies in track names between my splits & the MK8D python package (required to run the next method).
# Better option would've been to assign track NOs join/recode that way.
raw <- read_csv("_data/splits/MK8D_trks.csv")
abr <- read_csv("_data/track-abbr.csv")

t48 <- raw %>% 
  filter(Category == "48 Tracks") %>% 
  left_join(abr, by = c("Track" = "split")) %>% 
  select(ID, lss, Time:Category) %>% 
  mutate(lss = replace_na(lss,"Start"),
         Version = "Cartridge",
         Items = "No Items") %>% 
  rename("Track" = "lss")

write_csv(t48, "_data/splits/trks_48.csv")
```

```{bash runs48, eval=FALSE, include=FALSE}
# Adds center line (mean, median, max), offset for each run, and split time columns.
# Could be done easily in R to reduce number of files in folder.
MK8D_run2csv ./_data/splits/trks_48.csv ./_data/splits MK8D_runs_max.csv max
MK8D_run2csv ./_data/splits/trks_48.csv ./_data/splits MK8D_runs_mean.csv mean
```

# 48 Tracks

## Col 1 Tracks {data-width="350"}

### Violin Plot

```{r t0}
t0 <- t48 %>% 
  filter(Track != "Start") %>% 
  mutate(Time = seconds(Time),
         Track = fct_inorder(Track)) %>% 
  group_by(Track) %>% 
  mutate(sd = sd(Time)) %>% 
  ungroup() %>% 
  mutate(
    date = str_extract_all(ID, "\\d{2}/\\d{2}/\\d{2}"),
    date = ymd(date)
  ) %>% 
  filter(!is.na(date)) %>% 
  arrange(date) 

# Create ID for finished runs to make joining b/w tracks and runs easier
rg <- t0 %>% 
  group_by(ID) %>% 
  filter(any(Track == "Big Blue")) %>% 
  mutate(runNO = cur_group_id()) %>% 
  ungroup() %>% 
  select(date, runNO, ID) %>% 
  distinct()

t0 <- t0 %>% 
  left_join(rg, by = c("ID", "date"))
```

```{r gg48Violin}
gg48 <- t0 %>% 
  ggplot(aes(factor(Track), Time)) +
  geom_violin(draw_quantiles = 0.5, 
              scale = "width",
              aes(fill = sd, color=sd),
              alpha = .7) +
  stat_summary(fun = "median", geom = "point", size = .4) +
  scale_y_time() +
  scale_x_discrete(limits = rev(levels(t0$Track))) +
  coord_flip() +
  labs(x = "",
       y = "Time") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45,
                                   hjust = 0.98,
                                   vjust = 0.9),
        axis.text = element_text(size = 8),
        axis.ticks = element_line(size = .2),
        panel.grid = element_line(size = .2),
        panel.border = element_rect(fill = NA, size = .2),
        legend.position = "none")

ggplotly(gg48)
```

## Col 2 Runs {.tabset}

```{r r0, message=FALSE, warning=FALSE}
# Add column identifying stat, rename all files to have matching column names.
runMean <- read_csv("_data/splits/MK8D_runs_mean.csv") %>% 
  mutate(center = "mean", .before = `Center mean`) %>% 
  rename(c_time = `Center mean`,
         offset = `Center offset`)

runMax <- read_csv("_data/splits/MK8D_runs_max.csv") %>% 
  mutate(center = "max", .before = `Center amax`) %>% 
  rename(c_time = `Center amax`,
         offset = `Center offset`)

# Combine files so defining col_types w/ lubridate will be quicker.
r0 <- rbind(runMean, runMax) %>%
  mutate(
    Time = seconds(Time),
    c_time = seconds(c_time),
    offset = seconds(offset),
    Track = fct_inorder(Track),
    date = str_extract_all(ID, "\\d{2}/\\d{2}/\\d{2}"),
    date = ymd(date),
    Track = recode(Track, "Start" = " ")
  ) %>% 
  group_by(ID) %>% 
  mutate(runNO = cur_group_id()) %>% 
  ungroup()
```

```{r}
mm48 <- r0 %>% 
  select(Track, center, c_time) %>% 
  filter(center == "max") %>% 
  distinct() 

# Shortest tracks (track PB)
min48 <- t0 %>% 
  select(-c(Version:sd)) %>% 
  group_by(Track) %>% 
  slice_min(Time) %>% 
  ungroup() %>% 
  rename(PBdate = date,
         PBtime = Time)

# Sum of bests & labels
sob48 <- min48 %>% 
  mutate(Time = cumsum(PBtime),
         Time = seconds(Time)) %>% 
  select(Track, Time) %>% 
  add_row(Track = " ", Time = seconds(0), .before = 1) %>% 
  mutate(runNO = 0, ptss = seconds(NA)) %>% 
  left_join(mm48, by = "Track") %>% 
  mutate(offset = Time - c_time,
         label = paste0("<b>Sum of Best</b><br>", 
                        "Track: ", Track,
                        "<br>Offset: ", 
                        round(seconds_to_period(offset),2)
                        ))

# Detour: Possible time save for newest run
# find PB run, get track times
pb <- r0 %>% 
  filter(Track == "Big Blue" & center == "max") %>% 
  slice_min(Time) %>% 
  select(runNO) %>% 
  left_join(t0, by = "runNO")

# Join with minimum possible time and subtract
pts <- pb %>% 
  select(-c(Version:sd)) %>%
  left_join(min48 %>% select(Track, PBtime, PBdate), by = "Track") %>% 
  mutate(ptss = Time - PBtime) 
  

# Also adding labels for plotly
max48 <- r0 %>%
  filter(center == "max") %>%
  left_join(t0 %>% select(Track, Time, runNO), by = c("Track", "runNO")) %>% 
  left_join(pts %>% select(runNO, Track, ptss), by = c("runNO", "Track")) %>%
  mutate(label = paste0("Run #", runNO, " ", date, 
                        "<br>Track: ", Track,
                        "<br>Split Time: ", round(seconds_to_period(Time.y), 2),
                        "<br>Cumulative Offset: ", round(seconds_to_period(offset), 2)
                        ),
         label = case_when(
           ptss == 0 ~ label,
           is.na(ptss) ~ label,
           !is.na(ptss) ~ paste0(label, 
                                "<br>Possible Time Save: ", 
                                round(seconds_to_period(ptss), 3))
         )) %>%
  rename(Time = Time.x) %>% 
  select(Track, Time, runNO, ptss, center, c_time, offset, label) %>%
  rbind(sob48)

# Add color scale
color_range <- colorRampPalette(c("plum", "darkcyan"))

my_colors <- color_range(length(unique(max48$runNO)))

max49 <- max48 %>%
  mutate(clr = ifelse(runNO == 0, "grey", my_colors[max48$runNO]))
```

### Max

```{r gg48Max}
ggMax <- ggplot() +
  geom_line(data = max49, aes(
    factor(Track),
    offset,
    group = runNO,
    color = clr,
    alpha = runNO,
    text = label
  )) +
  geom_point(data = max49[which(max49$ptss > 0),], aes(
    factor(Track), 
    offset, 
    size = ptss,
    color = "tomato",
    text = label)) +
  scale_y_time() +
  scale_size_continuous(range = c(.05, 2.75)) +
  scale_color_identity() +
  scale_alpha_continuous(range = c(.35, .8)) +
  labs(x = "",
       y = "Offset Time from Max") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(
      angle = 45,
      hjust = 0.98,
      vjust = 0.9
    ),
    axis.text = element_text(size = 8),
    axis.ticks = element_line(size = .2),
    panel.grid = element_line(size = .2),
    panel.border = element_rect(fill = NA, size = .2),
    legend.position = "none"
  )

ggplotly(ggMax, tooltip = "text") %>% 
  layout(margin = list(t = 60),
    title = list(text = paste0('Improvement from Slowest Run',
                                    '<br><sup>48 Tracks, 150cc, No Items</sup>')))
```

> Points indicate possible time save from PB run.

### Mean

```{r gg48Mean}
ggMean <- r0 %>% 
  filter(center == "mean") %>%
  ggplot(aes(
    factor(Track),
    offset,
    group = ID,
    color = runNO,
    alpha = runNO
  )) +
  geom_line() +
  scale_y_time() +
  scale_color_continuous(low = "plum", high = "darkcyan") +
  scale_alpha_continuous(range = c(.35, .8)) +
  labs(x = "",
       y = "Offset Time from Mean") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(
      angle = 45,
      hjust = 0.98,
      vjust = 0.9
    ),
    axis.text = element_text(size = 8),
    axis.ticks = element_line(size = .2),
    panel.grid = element_line(size = .2),
    panel.border = element_rect(fill = NA, size = .2),
    legend.position = "none"
  )

ggplotly(ggMean)
```

# Nitro Cups {data-navmenu="Cups"}

```{r}
lvl <- paste(abr$cup, "Cup") %>% unique() %>% fct_inorder()

cups <- raw %>% 
  filter(str_detect(Category, "Cups")) %>% 
  mutate(Track = str_replace(Track, "^b", "w")) %>% 
  left_join(abr, by = c("Track" = "trk")) %>% 
  select(ID, trkNO, track, Time:Category) %>% 
  mutate(track = replace_na(track, "Start"),
         trkNO = replace_na(trkNO, 0),
         Version = "Cartridge",
         cup = Speed,
         Speed = "150cc",
         Items = "No Items",
         runID = str_extract(ID, "\\(.+\\)"),
         date = str_extract_all(ID, "\\d{2}/\\d{2}/\\d{2}"),
         date = ymd(date),
         cup = factor(cup, levels = lvl)) %>% 
  filter(!is.na(date)) %>% 
  group_by(runID) %>% 
  mutate(cumtime = cumsum(Time)) %>% 
  ungroup() %>% 
  arrange(trkNO) %>% 
  mutate(track = fct_inorder(track)) 
```

## Col 1 Tracks {data-width="350"}

```{r}
cnV <- cups %>% 
  filter(Category == "Nitro Cups" & track != "Start") %>% 
  group_by(track) %>% 
  mutate(Time = seconds(Time),
         sd = sd(Time)) %>% 
  ungroup()
```

### Violin Plot

```{r}
ggCNV <- cnV %>% 
  ggplot(aes(factor(track), Time)) +
  geom_violin(draw_quantiles = 0.5, 
              scale = "width",
              aes(fill = sd, color=sd),
              alpha = .7) +
  stat_summary(fun = "median", geom = "point", size = .4) +
  scale_y_time() +
  scale_x_discrete(limits = rev) +
  coord_flip() +
  labs(x = "",
       y = "Time") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45,
                                   hjust = 0.98,
                                   vjust = 0.9),
        axis.text = element_text(size = 8),
        axis.ticks = element_line(size = .2),
        panel.grid = element_line(size = .2),
        panel.border = element_rect(fill = NA, size = .2),
        legend.position = "none")

ggplotly(ggCNV)
```

## Col 2 Runs {.tabset}

```{r}
# Slice 10 most recent runs, add alpha value
c2 <- cups %>% 
  select(cup, ID) %>% 
  group_by(cup) %>% 
  distinct() %>% 
  mutate(runNO = dense_rank(ID)) %>%
  slice_max(runNO, n = 10) %>% 
  mutate(alph = dense_rank(runNO)) %>% 
  ungroup() %>% 
  left_join(cups, by = c("cup", "ID")) 

c3 <- cups %>% 
  select(cup, ID) %>% 
  group_by(cup) %>% 
  distinct() %>% 
  mutate(runNO = dense_rank(ID)) %>% 
  anti_join(c2, by = "ID") %>% 
  mutate(alph = 1) %>% 
  ungroup() %>% 
  left_join(cups, by = c("cup", "ID")) %>% 
  rbind(c2)

# Get max run
c4 <- c3 %>% 
  group_by(cup) %>% 
  slice_max(cumtime) %>% 
  ungroup() %>% 
  select(runID) %>% 
  left_join(c3, by = "runID") %>% 
  select(cup, track, cumtime) %>% 
  rename(max = cumtime) %>% 
  left_join(c3, by = c("cup", "track")) %>% 
  group_by(track) %>% 
  mutate(mean = mean(cumtime)) %>% 
  ungroup() %>% 
  pivot_longer(cols = c(max, mean), names_to = "stat", values_to = "ctime") %>% 
  mutate(
    offset = cumtime - ctime,
    cumtime = seconds(cumtime),
    Time = seconds(Time),
    ctime = seconds(ctime),
    offset = seconds(offset))
  
```

```{r}
cnT <- c4 %>%
  filter(Category == "Nitro Cups") %>% 
  mutate(track = recode(track, "Start" = " ")) 
```

### Max

```{r}
ggCNMax <- cnT %>% 
  filter(stat == "max") %>%
  ggplot(aes(
    factor(track),
    offset,
    group = ID,
    color = alph,
    alpha = alph
  )) +
  geom_line() +
  facet_wrap(~cup, scales = "free") +
  scale_x_discrete(labels = setNames(cnT$track, cnT$trkNO)) +
  scale_y_time() +
  scale_color_continuous(low = "plum", high = "darkcyan") +
  scale_alpha_continuous(range = c(.35, .8)) +
  labs(x = "",
       y = "") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(
      angle = 45,
      hjust = 0.98,
      vjust = 0.9
    ),
    axis.text = element_text(size = 8),
    axis.ticks = element_line(size = .2),
    panel.grid = element_line(size = .2),
    panel.border = element_rect(fill = NA, size = .2),
    legend.position = "none"
  )

m <- list(b = 110)

ggplotly(ggCNMax) %>% 
  layout(margin = m)
```

### Mean

```{r}
ggCNMean <- cnT %>% 
  filter(stat == "mean") %>%
  ggplot(aes(
    factor(track),
    offset,
    group = ID,
    color = alph,
    alpha = alph
  )) +
  geom_line() +
  facet_wrap(~cup, scales = "free") +
  scale_x_discrete(labels = setNames(cnT$track, cnT$trkNO)) +
  scale_y_time() +
  scale_color_continuous(low = "plum", high = "darkcyan") +
  scale_alpha_continuous(range = c(.35, .8)) +
  labs(x = "",
       y = "") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(
      angle = 45,
      hjust = 0.98,
      vjust = 0.9
    ),
    axis.text = element_text(size = 8),
    axis.ticks = element_line(size = .2),
    panel.grid = element_line(size = .2),
    panel.border = element_rect(fill = NA, size = .2),
    legend.position = "none"
  )

ggplotly(ggCNMean) %>% 
  layout(margin = m)
```

# Retro Cups {data-navmenu="Cups"}

## Col 1 Tracks {data-width="350"}

```{r}
crV <- cups %>% 
  filter(Category == "Retro Cups" & track != "Start") %>% 
  group_by(track) %>% 
  mutate(Time = seconds(Time),
         sd = sd(Time)) %>% 
  ungroup()
```

### Violin Plot

```{r}
ggCRV <- crV %>% 
  ggplot(aes(factor(track), Time)) +
  geom_violin(draw_quantiles = 0.5, 
              scale = "width",
              aes(fill = sd, color=sd),
              alpha = .7) +
  stat_summary(fun = "median", geom = "point", size = .4) +
  scale_y_time() +
  scale_x_discrete(limits = rev) +
  coord_flip() +
  labs(x = "",
       y = "Time") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45,
                                   hjust = 0.98,
                                   vjust = 0.9),
        axis.text = element_text(size = 8),
        axis.ticks = element_line(size = .2),
        panel.grid = element_line(size = .2),
        panel.border = element_rect(fill = NA, size = .2),
        legend.position = "none")

ggplotly(ggCRV) 
```

## Col 2 Runs {.tabset}

```{r}
crT <- c4 %>%
  filter(Category == "Retro Cups") %>% 
  mutate(track = recode(track, "Start" = " ")) 
```

### Max

```{r}
ggCRMax <- crT %>% 
  filter(stat == "max") %>%
  ggplot(aes(
    factor(track),
    offset,
    group = ID,
    color = alph,
    alpha = alph
  )) +
  geom_line() +
  facet_wrap(~cup, scales = "free") +
  scale_x_discrete(labels = setNames(crT$track, crT$trkNO)) +
  scale_y_time() +
  scale_color_continuous(low = "plum", high = "darkcyan") +
  scale_alpha_continuous(range = c(.35, .8)) +
  labs(x = "",
       y = "") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(
      angle = 45,
      hjust = 0.98,
      vjust = 0.9
    ),
    axis.text = element_text(size = 8),
    axis.ticks = element_line(size = .2),
    panel.grid = element_line(size = .2),
    panel.border = element_rect(fill = NA, size = .2),
    legend.position = "none"
  )

ggplotly(ggCRMax) %>% 
  layout(margin = m)
```

### Mean

```{r}
ggCRMean <- crT %>% 
  filter(stat == "mean") %>%
  ggplot(aes(
    factor(track),
    offset,
    group = ID,
    color = alph,
    alpha = alph
  )) +
  geom_line() +
  facet_wrap(~cup, scales = "free") +
  scale_x_discrete(labels = setNames(crT$track, crT$trkNO)) +
  scale_y_time() +
  scale_color_continuous(low = "plum", high = "darkcyan") +
  scale_alpha_continuous(range = c(.35, .8)) +
  labs(x = "",
       y = "") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(
      angle = 45,
      hjust = 0.98,
      vjust = 0.9
    ),
    axis.text = element_text(size = 8),
    axis.ticks = element_line(size = .2),
    panel.grid = element_line(size = .2),
    panel.border = element_rect(fill = NA, size = .2),
    legend.position = "none"
  )

ggplotly(ggCRMean) %>% 
  layout(margin = m)
```


# Bonus Cups {data-navmenu="Cups"}

## Col 1 Tracks {data-width="350"}

```{r}
cbV <- cups %>% 
  filter(Category == "Bonus Cups" & track != "Start") %>% 
  group_by(track) %>% 
  mutate(Time = seconds(Time),
         sd = sd(Time)) %>% 
  ungroup()
```

### Violin Plot

```{r}
ggCbV <- cbV %>% 
  ggplot(aes(factor(track), Time)) +
  geom_violin(draw_quantiles = 0.5, 
              scale = "width",
              aes(fill = sd, color=sd),
              alpha = .7) +
  stat_summary(fun = "median", geom = "point", size = .4) +
  scale_y_time() +
  scale_x_discrete(limits = rev) +
  coord_flip() +
  labs(x = "",
       y = "Time") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45,
                                   hjust = 0.98,
                                   vjust = 0.9),
        axis.text = element_text(size = 8),
        axis.ticks = element_line(size = .2),
        panel.grid = element_line(size = .2),
        panel.border = element_rect(fill = NA, size = .2),
        legend.position = "none")

ggplotly(ggCbV)
```

## Col 2 Runs {.tabset}

```{r}
cbT <- c4 %>%
  filter(Category == "Bonus Cups") %>% 
  mutate(track = recode(track, "Start" = " ")) 
```

### Max

```{r}
ggCbMax <- cbT %>% 
  filter(stat == "max") %>%
  ggplot(aes(
    factor(track),
    offset,
    group = ID,
    color = alph,
    alpha = alph
  )) +
  geom_line() +
  facet_wrap(~cup, scales = "free") +
  scale_x_discrete(labels = setNames(cbT$track, cbT$trkNO)) +
  scale_y_time() +
  scale_color_continuous(low = "plum", high = "darkcyan") +
  scale_alpha_continuous(range = c(.35, .8)) +
  labs(x = "",
       y = "") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(
      angle = 45,
      hjust = 0.98,
      vjust = 0.9
    ),
    axis.text = element_text(size = 8),
    axis.ticks = element_line(size = .2),
    panel.grid = element_line(size = .2),
    panel.border = element_rect(fill = NA, size = .2),
    legend.position = "none"
  )

ggplotly(ggCbMax) %>% 
  layout(margin = m)
```

### Mean

```{r}
ggCbMean <- cbT %>% 
  filter(stat == "mean") %>%
  ggplot(aes(
    factor(track),
    offset,
    group = ID,
    color = alph,
    alpha = alph
  )) +
  geom_line() +
  facet_wrap(~cup, scales = "free") +
  scale_x_discrete(labels = setNames(cbT$track, cbT$trkNO)) +
  scale_y_time() +
  scale_color_continuous(low = "plum", high = "darkcyan") +
  scale_alpha_continuous(range = c(.35, .8)) +
  labs(x = "",
       y = "") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(
      angle = 45,
      hjust = 0.98,
      vjust = 0.9
    ),
    axis.text = element_text(size = 8),
    axis.ticks = element_line(size = .2),
    panel.grid = element_line(size = .2),
    panel.border = element_rect(fill = NA, size = .2),
    legend.position = "none"
  )

ggplotly(ggCbMean) %>% 
  layout(margin = m)
```


# DLC Cups {data-navmenu="Cups"}

## Col 1 Tracks {data-width="350"}

```{r}
cdV <- cups %>% 
  filter(Category == "DLC Cups" & track != "Start") %>% 
  group_by(track) %>% 
  mutate(Time = seconds(Time),
         sd = sd(Time)) %>% 
  ungroup()
```

### Violin Plot

```{r}
ggCdV <- cdV %>% 
  ggplot(aes(factor(track), Time)) +
  geom_violin(draw_quantiles = 0.5, 
              scale = "width",
              aes(fill = sd, color=sd),
              alpha = .7) +
  stat_summary(fun = "median", geom = "point", size = .4) +
  scale_y_time() +
  scale_x_discrete(limits = rev) +
  coord_flip() +
  labs(x = "",
       y = "Time") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45,
                                   hjust = 0.98,
                                   vjust = 0.9),
        axis.text = element_text(size = 8),
        axis.ticks = element_line(size = .2),
        panel.grid = element_line(size = .2),
        panel.border = element_rect(fill = NA, size = .2),
        legend.position = "none")

ggplotly(ggCdV)
```

## Col 2 Runs {.tabset}

```{r}
cdT <- c4 %>%
  filter(Category == "DLC Cups") %>% 
  mutate(track = recode(track, "Start" = " ")) 
```

### Max

```{r}
ggCdMax <- cdT %>% 
  filter(stat == "max") %>%
  ggplot(aes(
    factor(track),
    offset,
    group = ID,
    color = alph,
    alpha = alph
  )) +
  geom_line() +
  facet_wrap(~cup, scales = "free") +
  scale_x_discrete(labels = setNames(cdT$track, cdT$trkNO)) +
  scale_y_time() +
  scale_color_continuous(low = "plum", high = "darkcyan") +
  scale_alpha_continuous(range = c(.35, .8)) +
  labs(x = "",
       y = "") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(
      angle = 45,
      hjust = 0.98,
      vjust = 0.9
    ),
    axis.text = element_text(size = 8),
    axis.ticks = element_line(size = .2),
    panel.grid = element_line(size = .2),
    panel.border = element_rect(fill = NA, size = .2),
    legend.position = "none"
  )

ggplotly(ggCdMax) %>% 
  layout(margin = m)
```

### Mean

```{r}
ggCdMean <- cdT %>% 
  filter(stat == "mean") %>%
  ggplot(aes(
    factor(track),
    offset,
    group = ID,
    color = alph,
    alpha = alph
  )) +
  geom_line() +
  facet_wrap(~cup, scales = "free") +
  scale_x_discrete(labels = setNames(cdT$track, cdT$trkNO)) +
  scale_y_time() +
  scale_color_continuous(low = "plum", high = "darkcyan") +
  scale_alpha_continuous(range = c(.35, .8)) +
  labs(x = "",
       y = "") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(
      angle = 45,
      hjust = 0.98,
      vjust = 0.9
    ),
    axis.text = element_text(size = 8),
    axis.ticks = element_line(size = .2),
    panel.grid = element_line(size = .2),
    panel.border = element_rect(fill = NA, size = .2),
    legend.position = "none"
  )

ggplotly(ggCdMean) %>% 
  layout(margin = m)
```
